---
applicationTemplate: &applicationTemplate
  name: template
  docker: &dockerImage
    image: template
    username: ((docker-username))
  health-check-type: process
  memory: ((default_memory))
  disk_quota: ((default_disk_quota))
  env: &defaultEnvs
    ENVIRONMENT: ((space))
    HTTP_PROXY_HOST: ((http_proxy_host))
    HTTP_PROXY_PORT: ((http_proxy_port))
    HTTP_PROXY_ENABLED: ((http_proxy_enabled))
    RUN_MIGRATION: ((run_migration))
    RUN_APP: 'true'
    DISABLE_INTERNAL_HTTPS: ((disable_internal_https))
    JAVA_OPTS: -Xms512m -Xmx1G
    TINI_SUBREAPER: ''
    DB_SSL_OPTION: ssl=((db_ssl))

applications:
  - <<: *applicationTemplate
    name: adminusers
    docker:
      <<: *dockerImage
      image: govukpay/adminusers:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '9701'
      JPA_LOG_LEVEL: ((log_level))
      JPA_SQL_LOG_LEVEL: ((log_level))
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: adminusers
      DB_PASSWORD: mysecretpassword
      LOGIN_ATTEMPT_CAP: '2'
      NOTIFY_SERVICE_ID: pay-notify-service-id
      NOTIFY_SECRET: pay-notify-secret-needs-to-be-32-chars-fsghdngfhmhfkrgsfs
      NOTIFY_API_KEY: api_key-pay-notify-service-id-pay-notify-secret-needs-to-be-32-chars-fsghdngfhmhfkrgsfs
      NOTIFY_2FA_TEMPLATE_ID: pay-notify-two-factor-template-id
      NOTIFY_INVITE_EMAIL_TEMPLATE_ID: pay-notify-invite-email-template-id
      NOTIFY_INVITE_USER_EMAIL_TEMPLATE_ID: pay-notify-invite-user-email-template-id
      NOTIFY_FORGOTTEN_PASSWORD_EMAIL_TEMPLATE_ID: pay-notify-forgotten-password-email-template-id
      NOTIFY_BASE_URL: http://stubs-((space)).apps.internal:8080/notify
      NOTIFY_INVITE_SERVICE_EMAIL_TEMPLATE_ID: pay-notify-invite-service-email-template-id
      NOTIFY_INVITE_SERVICE_USER_EXITS_EMAIL_TEMPLATE_ID: pay-notify-invite-service-user-exists-email-template-id
      NOTIFY_DIRECT_DEBIT_API_KEY: api_key-pay-notify-service-id-pay-notify-secret-needs-to-be-32-chars-fsghdngfhmhfkrgsfs
      NOTIFY_PAYMENT_CONFIRMED_TEMPLATE_ID: email-template-id
      NOTIFY_PAYMENT_FAILED_TEMPLATE_ID: email-template-id
      NOTIFY_MANDATE_FAILED_EMAIL_TEMPLATE_ID: email-template-id
      NOTIFY_MANDATE_CANCELLED_EMAIL_TEMPLATE_ID: email-template-id
      SELFSERVICE_URL: https://((selfservice_url))
      FORGOTTEN_PASSWORD_EXPIRY_MINUTES: '90'
    routes:
    - route: adminusers-((space)).apps.internal
  - <<: *applicationTemplate
    name: cardid
    docker:
      <<: *dockerImage
      image: govukpay/cardid:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '9801'
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
    routes:
    - route: cardid-((space)).apps.internal
  - <<: *applicationTemplate
    name: card-connector
    docker:
      <<: *dockerImage
      image: govukpay/connector:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '9301'
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: connector
      DB_PASSWORD: mysecretpassword
      FRONTEND_URL: https://((card_frontend_url))
      SECURE_WORLDPAY_NOTIFICATION_ENABLED: 'false'
      SECURE_WORLDPAY_NOTIFICATION_DOMAIN: london.cloudapps.digital
      GDS_CONNECTOR_WORLDPAY_URL: http://stubs-((space)).apps.internal:8080/stub/worldpay
      GDS_CONNECTOR_WORLDPAY_TEST_URL: http://stubs-((space)).apps.internal:8080/stub/worldpay
      GDS_CONNECTOR_WORLDPAY_LIVE_URL: http://stubs-((space)).apps.internal:8080/stub/worldpay
      APPLE_PAY_PAYMENT_PROCESSING_PRIVATE_KEY: MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgOqukXQoQVbg1xvvq/IGLdK0UuJPbbawULTALcuw/Uz2hRANCAAQPjiA1kTEodST2wy5d5kQFrM0D5qBX9Ukry8W6D+vC7OqbMoTm/upRM1GRHeA2LaVTrwAnpGhoO0ETqYF2Nu4V
      APPLE_PAY_PAYMENT_PROCESSING_CERTIFICATE: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVjRENDQkJhZ0F3SUJBZ0lJVXlyRU00SXpCSFF3Q2dZSUtvWkl6ajBFQXdJd2dZQXhOREF5QmdOVkJBTU0KSzBGd2NHeGxJRmR2Y214a2QybGtaU0JFWlhabGJHOXdaWElnVW1Wc1lYUnBiMjV6SUVOQklDMGdSekl4SmpBawpCZ05WQkFzTUhVRndjR3hsSUVObGNuUnBabWxqWVhScGIyNGdRWFYwYUc5eWFYUjVNUk13RVFZRFZRUUtEQXBCCmNIQnNaU0JKYm1NdU1Rc3dDUVlEVlFRR0V3SlZVekFlRncweE5ERXdNall4TWpFd01UQmFGdzB4TmpFeE1qUXgKTWpFd01UQmFNSUdoTVM0d0xBWUtDWkltaVpQeUxHUUJBUXdlYldWeVkyaGhiblF1WTI5dExuTmxZWFJuWldWcgpMbE5sWVhSSFpXVnJNVFF3TWdZRFZRUUREQ3ROWlhKamFHRnVkQ0JKUkRvZ2JXVnlZMmhoYm5RdVkyOXRMbk5sCllYUm5aV1ZyTGxObFlYUkhaV1ZyTVJNd0VRWURWUVFMREFvNVFqTlJXVGxYUWxvMU1SY3dGUVlEVlFRS0RBNVQKWldGMFIyVmxheXdnU1c1akxqRUxNQWtHQTFVRUJoTUNWVk13V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQgpCd05DQUFRUGppQTFrVEVvZFNUMnd5NWQ1a1FGck0wRDVxQlg5VWtyeThXNkQrdkM3T3FiTW9UbS91cFJNMUdSCkhlQTJMYVZUcndBbnBHaG9PMEVUcVlGMk51NFZvNElDVlRDQ0FsRXdSd1lJS3dZQkJRVUhBUUVFT3pBNU1EY0cKQ0NzR0FRVUZCekFCaGl0b2RIUndPaTh2YjJOemNDNWhjSEJzWlM1amIyMHZiMk56Y0RBMExXRndjR3hsZDNkawpjbU5oTWpBeE1CMEdBMVVkRGdRV0JCUVdHZktnUGdWQlg4Sk92ODRxMWMwNEhTaE1tekFNQmdOVkhSTUJBZjhFCkFqQUFNQjhHQTFVZEl3UVlNQmFBRklTMmhNdzZobUp5RmxtVTZCcWp2VWpmT3Q4TE1JSUJIUVlEVlIwZ0JJSUIKRkRDQ0FSQXdnZ0VNQmdrcWhraUc5Mk5rQlFFd2dmNHdnY01HQ0NzR0FRVUZCd0lDTUlHMkRJR3pVbVZzYVdGdQpZMlVnYjI0Z2RHaHBjeUJqWlhKMGFXWnBZMkYwWlNCaWVTQmhibmtnY0dGeWRIa2dZWE56ZFcxbGN5QmhZMk5sCmNIUmhibU5sSUc5bUlIUm9aU0IwYUdWdUlHRndjR3hwWTJGaWJHVWdjM1JoYm1SaGNtUWdkR1Z5YlhNZ1lXNWsKSUdOdmJtUnBkR2x2Ym5NZ2IyWWdkWE5sTENCalpYSjBhV1pwWTJGMFpTQndiMnhwWTNrZ1lXNWtJR05sY25ScApabWxqWVhScGIyNGdjSEpoWTNScFkyVWdjM1JoZEdWdFpXNTBjeTR3TmdZSUt3WUJCUVVIQWdFV0ttaDBkSEE2Ckx5OTNkM2N1WVhCd2JHVXVZMjl0TDJObGNuUnBabWxqWVhSbFlYVjBhRzl5YVhSNUx6QTJCZ05WSFI4RUx6QXQKTUN1Z0thQW5oaVZvZEhSd09pOHZZM0pzTG1Gd2NHeGxMbU52YlM5aGNIQnNaWGQzWkhKallUSXVZM0pzTUE0RwpBMVVkRHdFQi93UUVBd0lES0RCUEJna3Foa2lHOTJOa0JpQUVRZ3hBUmprek9FWTBOalU0UTBFeVF6RkRPVU16Ck9FSTRSRVpEUWpWRVFrSXlRVEl5TkRVMk1EZEVSRVV5UmpFeE5EWXlNRVU0TkRZNFJVWTFNa1F5TURoRFFUQUsKQmdncWhrak9QUVFEQWdOSUFEQkZBaUIrUTR6enBNajJESlRDSWhERkJjbXdLMXpRQUM3MGZZMklzWWQ4K054dQp1d0loQUtqOVJyVE95aWFRbm9UNU1xaTNVSG9wYjZ4VHVnbDNMVURCbG9yYUJIeVAKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==
      GDS_CONNECTOR_SMARTPAY_URL: http://stubs-((space)).apps.internal:8080/stub/smartpay
      GDS_CONNECTOR_SMARTPAY_TEST_URL: http://stubs-((space)).apps.internal:8080/stub/smartpay
      GDS_CONNECTOR_SMARTPAY_LIVE_URL: http://stubs-((space)).apps.internal:8080/stub/smartpay
      GDS_CONNECTOR_EPDQ_TEST_URL: http://stubs-((space)).apps.internal:8080/stub/epdq
      GDS_CONNECTOR_EPDQ_LIVE_URL: http://stubs-((space)).apps.internal:8080/stub/epdq
      GDS_CONNECTOR_SMARTPAY_NOTIFICATION_USER: smartpay-user
      GDS_CONNECTOR_SMARTPAY_NOTIFICATION_PASSWORD: smartpay-password
      STRIPE_TRANSACTION_FEE_PERCENTAGE: '0.1'
      JPA_LOG_LEVEL: ((log_level))
      JPA_SQL_LOG_LEVEL: ((log_level))
      HTTP_PROXY_SCHEME: http
      AUTH_READ_TIMEOUT_SECONDS: '1'
      NOTIFY_EMAIL_ENABLED: 'true'
      NOTIFY_PAYMENT_RECEIPT_EMAIL_TEMPLATE_ID: email-template-id
      NOTIFY_REFUND_ISSUED_EMAIL_TEMPLATE_ID: email-refund-issued-template-id
      NOTIFY_API_KEY: api_key-pay-notify-service-id-pay-notify-secret-needs-to-be-32-chars-fsghdngfhmhfkrgsfs
      NOTIFY_BASE_URL: http://stubs-((space)).apps.internal:8080/notify
      CAPTURE_PROCESS_SCHEDULER_INITIAL_DELAY_SECONDS: '0'
      CAPTURE_PROCESS_SCHEDULER_RANDOM_INTERVAL_MINIMUM_SECONDS: '1'
      CAPTURE_PROCESS_SCHEDULER_RANDOM_INTERVAL_MAXIMUM_SECONDS: '1'
      XRAY_ENABLED: false
      CAPTURE_USING_SQS_FEATURE_FLAG: 'true'
      AWS_SQS_REGION: region-1
      AWS_SQS_CAPTURE_QUEUE_URL: http://sqs-((space)).apps.internal:9324/queue/pay_capture_queue
      AWS_SECRET_KEY: x
      AWS_ACCESS_KEY: x
      AWS_SQS_NON_STANDARD_SERVICE_ENDPOINT: 'true'
      AWS_SQS_ENDPOINT: http://sqs-((space)).apps.internal:9324
      AWS_SQS_MESSAGE_MAXIMUM_WAIT_TIME_IN_SECONDS: '20'
      EVENT_QUEUE_ENABLED: 'true'
      AWS_SQS_PAYMENT_EVENT_QUEUE_URL: http://sqs-((space)).apps.internal:9324/queue/pay_event_queue
      RUN_MIGRATION: 'true'
    routes:
    - route: card-connector-((space)).apps.internal
  - <<: *applicationTemplate
    name: directdebit-connector
    docker:
      <<: *dockerImage
      image: govukpay/directdebit-connector:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '10201'
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: directdebit_connector
      DB_PASSWORD: mysecretpassword
      FRONTEND_URL: https://((directdebit_frontend_url))
      ADMINUSERS_URL: http://adminusers-((space)).apps.internal:8080
      GDS_DIRECTDEBIT_CONNECTOR_GOCARDLESS_ACCESS_TOKEN: supersecret
      GDS_DIRECTDEBIT_CONNECTOR_GOCARDLESS_URL: http://stubs-((space)).apps.internal:8080/stub/gocardless/
      GDS_DIRECTDEBIT_CONNECTOR_GOCARDLESS_WEBHOOK_SECRET: supersecret
      GDS_DIRECTDEBIT_CONNECTOR_GOCARDLESS_ENVIRONMENT: sandbox
      JPA_LOG_LEVEL: ((log_level))
      JPA_SQL_LOG_LEVEL: ((log_level))
      AUTH_READ_TIMEOUT_SECONDS: '1'
      GOCARDLESS_TEST_CLIENT_ID: gocardless-test-oauth-client-id
      GOCARDLESS_TEST_CLIENT_SECRET: gocardless-test-oauth-client-secret
      GOCARDLESS_LIVE_CLIENT_ID: gocardless-live-oauth-client-id
      GOCARDLESS_LIVE_CLIENT_SECRET: gocardless-live-oauth-client-secret
      GOCARDLESS_TEST_OAUTH_BASE_URL: https://connect-sandbox.gocardless.com
      GOCARDLESS_LIVE_OAUTH_BASE_URL: https://connect-sandbox.gocardless.com
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
      SENTRY_DSN: noop://localhost
    routes:
    - route: directdebit-connector-((space)).apps.internal
  - <<: *applicationTemplate
    name: directdebit-frontend
    docker:
      <<: *dockerImage
      image: govukpay/directdebit-frontend:latest-master
    env:
      <<: *defaultEnvs
      NODE_WORKER_COUNT: '1'
      COOKIE_MAX_AGE: '5400000'
      SESSION_ENCRYPTION_KEY: asdjhbwefbo23r23rbfik2roiwhefwbqw
      CONNECTOR_URL: http://directdebit-connector-((space)).apps.internal:8080
      ADMINUSERS_URL: http://adminusers-((space)).apps.internal:8080
    routes:
    - route: ((directdebit_frontend_url))
  - <<: *applicationTemplate
    name: egress
    docker:
      <<: *dockerImage
      image: govukpay/egress@sha256:8bf84bc285b5be78a12a1611cfb3521efbdb6c83bd813f902623b01c0e5ad932
    env:
      <<: *defaultEnvs
      SQUID_CONFIG: YWNsIFNTTF9wb3J0cyBwb3J0IDQ0MwphY2wgU2FmZV9wb3J0cyBwb3J0IDgwCmFjbCBTYWZlX3BvcnRzIHBvcnQgNDQzCmh0dHBfYWNjZXNzIGFsbG93IGFsbApodHRwX3BvcnQgODA4MApjYWNoZSBkZW55IGFsbAphY2Nlc3NfbG9nIG5vbmUKY2FjaGVfbG9nIC9kZXYvbnVsbApjYWNoZV9zdG9yZV9sb2cgbm9uZQpwaWRfZmlsZW5hbWUgbm9uZQo=
    routes:
    - route: egress-((space)).apps.internal
  - <<: *applicationTemplate
    name: card-frontend
    docker:
      <<: *dockerImage
      image: govukpay/frontend:latest-master
    env:
      <<: *defaultEnvs
      SESSION_ENCRYPTION_KEY: asdjhbwefbo23r23rbfik2roiwhefwbqw
      COOKIE_MAX_AGE: '5400000'
      CONNECTOR_TOKEN_URL: http://card-connector-((space)).apps.internal:8080/v1/frontend/tokens/{chargeTokenId}
      CONNECTOR_URL: http://card-connector-((space)).apps.internal:8080
      CONNECTOR_HOST: http://card-connector-((space)).apps.internal:8080
      ANALYTICS_TRACKING_ID: testing-123
      CARDID_HOST: http://cardid-((space)).apps.internal:8080
      NODE_WORKER_COUNT: '1'
      FRONTEND_URL: https://((card_frontend_url))
      ADMINUSERS_URL: http://adminusers-((space)).apps.internal:8080
    routes:
    - route: ((card_frontend_url))
  - <<: *applicationTemplate
    name: ledger
    docker:
      <<: *dockerImage
      image: govukpay/ledger:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '10701'
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: ledger
      DB_PASSWORD: mysecretpassword
      AWS_SQS_REGION: region-1
      AWS_SECRET_KEY: x
      AWS_ACCESS_KEY: x
      AWS_SQS_NON_STANDARD_SERVICE_ENDPOINT: 'true'
      AWS_SQS_ENDPOINT: http://sqs-((space)).apps.internal:9324
      AWS_SQS_MESSAGE_MAXIMUM_WAIT_TIME_IN_SECONDS: '20'
      QUEUE_MESSAGE_RECEIVER_THREAD_DELAY_IN_MILLISECONDS: '1000'
      AWS_SQS_PAYMENT_EVENT_QUEUE_URL: http://sqs-((space)).apps.internal:9324/queue/pay_event_queue
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
    routes:
    - route: ledger-((space)).apps.internal
  - <<: *applicationTemplate
    name: products
    docker:
      <<: *dockerImage
      image: govukpay/products:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '10001'
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: products
      DB_PASSWORD: mysecretpassword
      JPA_LOG_LEVEL: ((log_level))
      JPA_SQL_LOG_LEVEL: ((log_level))
      PUBLICAPI_URL: https://((publicapi_url))
      BASE_URL: http://products-((space)).apps.internal:8080
      PRODUCTS_API_TOKEN: g0nBA5lNzfUalQjk4ZBDy70AikNshxz2G70dA6lg
      PRODUCTSUI_PAY_URL: https://((products_ui_url))
      PRODUCTSUI_CONFIRMATION_URL: https://((products_ui_url))/payment-complete
      PRODUCTS_FRIENDLY_BASE_URI: https://((products_ui_url))/redirect
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
    routes:
    - route: products-((space)).apps.internal
  - <<: *applicationTemplate
    name: products-ui
    docker:
      <<: *dockerImage
      image: govukpay/products-ui:latest-master
    env:
      <<: *defaultEnvs
      PUBLICAPI_URL: https://((publicapi_url))
      PAY_API_URL: https://((publicapi_url))
      SELFSERVICE_TRANSACTIONS_URL: https://((selfservice_url))/transactions
      ADMINUSERS_URL: http://adminusers-((space)).apps.internal:8080
      PRODUCTS_API_TOKEN: g0nBA5lNzfUalQjk4ZBDy70AikNshxz2G70dA6lg
      PRODUCTS_URL: http://products-((space)).apps.internal:8080
      SESSION_ENCRYPTION_KEY: asdjhbwefbo23r23rbfik2roiwhefwbqw
      COOKIE_MAX_AGE: '3600000'
    routes:
    - route: ((products_ui_url))
  - <<: *applicationTemplate
    name: publicapi
    docker:
      <<: *dockerImage
      image: govukpay/publicapi:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '9101'
      CONNECTOR_URL: http://card-connector-((space)).apps.internal:8080
      CONNECTOR_DD_URL: http://directdebit-connector-((space)).apps.internal:8080
      PUBLIC_AUTH_URL: https://((publicauth_url))/v1/api/auth
      TOKEN_API_HMAC_SECRET: qwer9yuhgf
      PUBLICAPI_BASE: https://((publicapi_url))
      LEDGER_URL: http://ledger-((space)).apps.internal:8080
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
    routes:
    - route: ((publicapi_url))
  - <<: *applicationTemplate
    name: publicauth
    docker:
      <<: *dockerImage
      image: govukpay/publicauth:latest-master
    env:
      <<: *defaultEnvs
      ADMIN_PORT: '9601'
      DB_HOST: postgres-((space)).apps.internal
      DB_USER: publicauth
      DB_PASSWORD: mysecretpassword
      TOKEN_DB_BCRYPT_SALT: $2a$10$IhaXo6LIBhKIWOiGpbtPOu
      TOKEN_API_HMAC_SECRET: qwer9yuhgf
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
    routes:
    - route: ((publicauth_url))
  - <<: *applicationTemplate
    name: selfservice
    docker:
      <<: *dockerImage
      image: govukpay/selfservice:latest-master
    env:
      <<: *defaultEnvs
      SESSION_ENCRYPTION_KEY: asdjhbwefbo23r23rbfik2roiwhefwbqw
      PUBLIC_AUTH_URL: https://((publicauth_url))/v1/frontend/auth
      CONNECTOR_URL: http://card-connector-((space)).apps.internal:8080
      DIRECT_DEBIT_CONNECTOR_URL: http://directdebit-connector-((space)).apps.internal:8080
      ADMINUSERS_URL: http://adminusers-((space)).apps.internal:8080
      SELFSERVICE_BASE: https://((selfservice_url))
      PRODUCTS_URL: http://products-((space)).apps.internal:8080
      PRODUCTS_API_TOKEN: g0nBA5lNzfUalQjk4ZBDy70AikNshxz2G70dA6lg
      PRODUCTS_FRIENDLY_BASE_URI: https://((products_ui_url))/redirect
      LOGIN_ATTEMPT_CAP: '3'
      COOKIE_MAX_AGE: '10800000'
      NODE_WORKER_COUNT: '1'
      PGSSLMODE: verify-full
      AWS_XRAY_DAEMON_ADDRESS: xray:2000
      EPDQ_3DS_ENABLED: 'true'
      SMARTPAY_3DS_ENABLED: 'true'
      GOCARDLESS_TEST_CLIENT_ID: gocardless-test-oauth-client-id
      GOCARDLESS_LIVE_CLIENT_ID: gocardless-live-oauth-client-id
      GOCARDLESS_TEST_OAUTH_BASE_URL: https://connect-sandbox.gocardless.com
      GOCARDLESS_LIVE_OAUTH_BASE_URL: https://connect-sandbox.gocardless.com
      SELFSERVICE_URL: https://((selfservice_url))
      AWS_XRAY_CONTEXT_MISSING: LOG_ERROR
      LEDGER_URL: http://ledger-((space)).apps.internal:8080
    routes:
    - route: ((selfservice_url))
  - <<: *applicationTemplate
    name: notifications
    docker:
      <<: *dockerImage
      image: govukpaypaas/notifications:latest-master
    env:
      CONNECTOR_URL: http://card-connector-((space)).apps.internal:8080
      DD_CONNECTOR_URL: http://directdebit-connector-((space)).apps.internal:8080
    routes:
    - route: ((notifications_url))
  - <<: *applicationTemplate
    name: postgres
    docker:
      <<: *dockerImage
      image: postgres:latest
    command: |
      echo "CREATE EXTENSION \"uuid-ossp\";
            CREATE EXTENSION IF NOT EXISTS pg_trgm WITH SCHEMA pg_catalog;
            CREATE USER connector WITH password 'mysecretpassword';
            CREATE DATABASE connector WITH owner=connector TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE connector TO connector;
            CREATE USER publicauth WITH password 'mysecretpassword';
            CREATE DATABASE publicauth WITH owner=publicauth TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE publicauth TO publicauth;
            CREATE USER adminusers WITH password 'mysecretpassword';
            CREATE DATABASE adminusers WITH owner=adminusers TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE adminusers TO adminusers;
            CREATE USER products WITH password 'mysecretpassword';
            CREATE DATABASE products WITH owner=products TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE products TO products;
            CREATE USER directdebit_connector WITH password 'mysecretpassword';
            CREATE DATABASE directdebit_connector WITH owner=directdebit_connector TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE directdebit_connector TO directdebit_connector;
            CREATE USER ledger WITH password 'mysecretpassword';
            CREATE DATABASE ledger WITH owner=ledger TEMPLATE postgres;
            GRANT ALL PRIVILEGES ON DATABASE ledger TO ledger;" > /docker-entrypoint-initdb.d/init.sql && \
      exec docker-entrypoint.sh postgres
    env:
      <<: *defaultEnvs
      POSTGRES_PASSWORD: mysecretpassword
    routes:
    - route: postgres-((space)).apps.internal
  - <<: *applicationTemplate
    name: sqs
    docker:
      <<: *dockerImage
      image: roribio16/alpine-sqs@sha256:2651d01db38cc9faa8184a4c87a93d95aa2aa3bb992b9e41ea6b4742dc8893bb
    command: mkdir /opt/custom && echo "$EMQ_CONFIG" | base64 -d > /opt/custom/elasticmq.conf
      && /usr/bin/supervisord -n -c /etc/supervisor/supervisord.conf
    env:
      <<: *defaultEnvs
      EMQ_CONFIG: bm9kZS1hZGRyZXNzIHsKICBwcm90b2NvbCA9IGh0dHAKICBob3N0ID0gIioiCiAgcG9ydCA9IDkzMjQKICBjb250ZXh0LXBhdGggPSAiIgp9CgpyZXN0LXNxcyB7CiAgZW5hYmxlZCA9IHRydWUKICBiaW5kLXBvcnQgPSA5MzI0CiAgYmluZC1ob3N0bmFtZSA9ICIwLjAuMC4wIgogIC8vIFBvc3NpYmxlIHZhbHVlczogcmVsYXhlZCwgc3RyaWN0CiAgc3FzLWxpbWl0cyA9IHN0cmljdAp9CgpxdWV1ZXMgewogIGRlZmF1bHQgewogICAgZGVmYXVsdFZpc2liaWxpdHlUaW1lb3V0ID0gMTAgc2Vjb25kcwogICAgZGVsYXkgPSA1IHNlY29uZHMKICAgIHJlY2VpdmVNZXNzYWdlV2FpdCA9IDAgc2Vjb25kcwogIH0KCiAgcGF5X2NhcHR1cmVfcXVldWUgewogICAgZGVmYXVsdFZpc2liaWxpdHlUaW1lb3V0ID0gMzYwMCBzZWNvbmRzCiAgICBkZWxheSA9IDAgc2Vjb25kcwogICAgcmVjZWl2ZU1lc3NhZ2VXYWl0ID0gNSBzZWNvbmRzCiAgfQoKICBwYXlfZXZlbnRfcXVldWUgewogICAgZGVmYXVsdFZpc2liaWxpdHlUaW1lb3V0ID0gMzYwMCBzZWNvbmRzCiAgICBkZWxheSA9IDAgc2Vjb25kcwogICAgcmVjZWl2ZU1lc3NhZ2VXYWl0ID0gNSBzZWNvbmRzCiAgfQp9Cgpha2thLmh0dHAuc2VydmVyLnBhcnNpbmcuaWxsZWdhbC1oZWFkZXItd2FybmluZ3MgPSBvZmYKYWtrYS5odHRwLnNlcnZlci5yZXF1ZXN0LXRpbWVvdXQgPSA0MCBzZWNvbmRzCg==
    routes:
    - route: sqs-((space)).apps.internal
