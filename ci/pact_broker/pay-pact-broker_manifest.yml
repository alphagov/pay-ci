applications:
- name: pay-pact-broker
  command: |
    eval $(ruby -rjson -e 'vcap=JSON.parse(ENV["VCAP_SERVICES"]);
      puts "export PACT_BROKER_DATABASE_USERNAME=#{vcap["postgres"][0]["credentials"]["username"]}";
      puts "export PACT_BROKER_DATABASE_PASSWORD=#{vcap["postgres"][0]["credentials"]["password"]}";
      puts "export PACT_BROKER_DATABASE_HOST=#{vcap["postgres"][0]["credentials"]["host"]}";
      puts "export PACT_BROKER_DATABASE_NAME=#{vcap["postgres"][0]["credentials"]["name"]}";
    ') && ./entrypoint.sh config.ru
  disk_quota: 1G
  docker:
    image: pactfoundation/pact-broker:2.54.0.0
  env:
    PACT_BROKER_BASIC_AUTH_USERNAME: ((pact-broker-username))
    PACT_BROKER_BASIC_AUTH_PASSWORD: ((pact-broker-password))
  health-check-type: process
  instances: 1
  memory: 1G
  routes:
    - route: pay-pact-broker.cloudapps.digital
    - route: pact-broker-test.cloudapps.digital
  services:
    - pact-broker-db
  stack: cflinuxfs3
